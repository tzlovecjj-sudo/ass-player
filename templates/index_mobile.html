<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ASS字幕播放器 - 移动端</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
    <style>
        /* 简单的移动端适配样式，优先覆盖桌面布局中的布局问题 */
        body { font-size: 16px; padding: 0; margin: 0; background: #111; color: #eee; }
        .mobile-container { display: flex; flex-direction: column; gap: 8px; padding: 12px; }
        .video-wrap { position: relative; width: 100%; background: #000; border-radius: 8px; overflow: hidden; }
        video { width: 100%; height: auto; display: block; background: #000; }
        .mobile-controls { display:flex; gap:8px; align-items:center; justify-content:space-between; margin-top:6px; }
        .mobile-inputs { display:flex; gap:8px; margin-top:8px; }
        input[type="text"]{ flex:1; padding:8px; border-radius:6px; border:1px solid #444; background:#222; color:#fff }
        button { padding:8px 10px; border-radius:6px; border:none; background:#2d8cff; color:#fff }
        .small { font-size: 13px; color:#bbb }
        .link-desktop { text-align:center; margin-top:8px }
        .link-desktop a { color:#2d8cff }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div id="mobile-header">
            <div class="mobile-header-top">
                <h2 class="visually-hidden">ASS字幕播放器</h2>
            </div>

            <div class="video-wrap">
                <video id="videoPlayer" playsinline webkit-playsinline controls crossorigin="anonymous">
                    您的浏览器不支持视频播放
                </video>
                <!-- 为保持与桌面播放器兼容，加入 canvas 供字幕渲染使用 -->
                <canvas id="videoCanvas" width="1280" height="720" style="display:block; width:100%; height:auto; background:#000"></canvas>
            </div>

            <!-- 使用与桌面一致的 controls 结构，便于播放器模块统一初始化 -->
            <div class="controls" id="mobileControls">
                <div class="controls-left">
                    <button id="playPauseBtn" class="play-pause-btn" title="播放/暂停">▶️</button>
                    <button id="restartBtn" title="重新开始">↺</button>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress" id="progress"></div>
                    </div>
                    <div class="progress-time">
                        <span id="currentProgressTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>

                <div class="controls-right">
                    <button id="muteBtn" title="静音/取消静音">🔇</button>
                    <!-- 移动端使用浮动音量控件以避免工具栏溢出；桌面滑块已移除 -->
                    <button id="fullscreenBtn" title="网页全屏">⛶</button>
                </div>
            </div>

            <!-- 注意：移动端面板已包含可见的文件输入，避免重复 ID 导致事件绑定到不可见元素 -->

            <div class="subtitle-preview-container" id="mobileSubtitlePreview">
                <div class="subtitle-preview-content" id="subtitlePreview">字幕将在这里实时显示</div>
            </div>
        </div>

        <div class="mobile-panel" id="mobilePanel">
            <!-- 临时恢复的视频/字幕加载面板（移动端调试用） -->
            <div class="panel-section">
                <h3>视频源设置</h3>

                <!-- 移动端移除本地视频上传，仅支持通过 URL 加载视频 -->
                <div class="upload-group">
                    <label for="onlineVideoUrl">🌐 在线视频URL</label>
                    <div class="url-input-container">
                        <input type="text" id="onlineVideoUrl" placeholder="请输入B站视频页或直链">
                        <button id="loadOnlineVideoBtn">加载</button>
                    </div>
                    <div class="platform-info">支持自动解析 B 站视频</div>
                </div>

                <div class="upload-group">
                    <label for="subtitleFile">📝 选择ASS字幕文件</label>
                    <input type="file" id="subtitleFile" accept=".ass">
                    <div class="platform-info">仅支持 ASS 格式</div>
                </div>

                <div id="uploadStatus" class="status"></div>
            </div>
            <div class="panel-row">
                <div class="label">视频标题</div>
                <div class="value" id="videoTitle">未加载</div>
            </div>
            <div class="panel-row">
                <div class="label">分辨率</div>
                <div class="value" id="videoResolution">-</div>
            </div>
            <div class="panel-row">
                <div class="label">时长</div>
                <div class="value" id="videoDuration">-</div>
            </div>
            <div class="panel-row">
                <div class="label">字幕文件</div>
                <div class="value" id="subtitleName">未加载</div>
            </div>
            <div class="panel-row">
                <div class="label">字幕数量</div>
                <div class="value" id="subtitleCount">-</div>
            </div>

            <div style="margin-top:10px;font-size:12px;color:#888">提示：移动端已精简界面，选择视频/字幕与下载功能已隐藏。</div>

            <div class="small link-desktop" style="margin-top:12px">如果你更喜欢桌面版，<a id="forceDesktopLink" href="/?desktop=1">点此打开桌面版</a></div>
        </div>

        <div style="height:40px"></div>
    </div>

    <!-- 通过外部脚本从 /config.json 拉取运行时配置，避免内联脚本触发 CSP 限制 -->
    <script src="{{ url_for('static', filename='js/load-config.js') }}" defer></script>
</body>
</html>
